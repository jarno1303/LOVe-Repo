{% extends "base.html" %}

{% block title %}Kojelauta - LOVe Enhanced{% endblock %}

{% block extra_head %}
<style>
    .card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        border: 0;
        cursor: pointer;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.8rem 1.5rem rgba(0,0,0,0.15) !important;
    }
    
    .card-icon {
        font-size: 3.5rem;
        margin-bottom: 1rem;
    }
    
    .card-clickable {
        text-decoration: none;
        color: inherit;
        display: block;
        height: 100%;
    }
    
    .jumbotron {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        border-radius: 15px;
        padding: 3rem 2rem;
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="jumbotron shadow-sm">
        <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-graduation-cap me-3"></i>Tervetuloa oppimaan, {{ current_user.username }}!
        </h1>
        <p class="lead mb-0">
            Valitse alta haluamasi harjoittelumuoto, tarkastele edistymist√§si tai jahtaa saavutuksia.
        </p>
    </div>

    <!-- Cards Grid -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mb-4">
        
        <!-- R√§√§t√§l√∂ity harjoitus -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="openPracticeModal()" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üìö</div>
                    <h5 class="card-title mt-3 mb-2">R√§√§t√§l√∂ity harjoitus</h5>
                    <p class="card-text text-muted small">
                        Valitse kategoriat, vaikeustaso ja kysymysten m√§√§r√§.
                    </p>
                </div>
            </div>
        </div>

        <!-- √Ñlyk√§s kertaus -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('review_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üß†</div>
                    <h5 class="card-title mt-3 mb-2">√Ñlyk√§s kertaus</h5>
                    <p class="card-text text-muted small">
                        Kertaa aiemmin vaikeiksi osoittautuneita kysymyksi√§.
                    </p>
                </div>
            </div>
        </div>

        <!-- Koesimulaatio -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('simulation_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üéØ</div>
                    <h5 class="card-title mt-3 mb-2">Koesimulaatio</h5>
                    <p class="card-text text-muted small">
                        Testaa osaamisesi 50 kysymyksen kokeella.
                    </p>
                </div>
            </div>
        </div>

        <!-- Omat tilastot -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('stats_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üìä</div>
                    <h5 class="card-title mt-3 mb-2">Omat tilastot</h5>
                    <p class="card-text text-muted small">
                        Analysoi edistymist√§si ja l√∂yd√§ kehityskohteesi.
                    </p>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Additional Cards Row -->
    <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
        
        <!-- Saavutukset -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('achievements_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üèÜ</div>
                    <h5 class="card-title mt-3 mb-2">Saavutukset</h5>
                    <p class="card-text text-muted small">
                        Katso avattuja saavutuksiasi ja tavoittele uusia.
                    </p>
                </div>
            </div>
        </div>

        <!-- Asetukset -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('settings_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <h5 class="card-title mt-3 mb-2">Asetukset</h5>
                    <p class="card-text text-muted small">
                        Hallinnoi tili√§si ja muokkaa asetuksiasi.
                    </p>
                </div>
            </div>
        </div>

        <!-- Profiili -->
        <div class="col">
            <div class="card h-100 text-center shadow-sm" onclick="window.location.href='{{ url_for('profile_route') }}'" role="button" tabindex="0">
                <div class="card-body p-4">
                    <div class="card-icon">üë§</div>
                    <h5 class="card-title mt-3 mb-2">Profiili</h5>
                    <p class="card-text text-muted small">
                        Tarkastele profiiliasi ja oppimishistoriaasi.
                    </p>
                </div>
            </div>
        </div>
        
    </div>
</div>

<!-- Custom Practice Modal -->
<div class="modal fade" id="practiceModal" tabindex="-1" aria-labelledby="practiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="practiceModalLabel">
                    <i class="fas fa-sliders-h me-2"></i>R√§√§t√§l√∂i harjoitus
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="practice-form">
                    <!-- Kategoriat -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-folder me-2"></i>1. Valitse kategoriat:
                        </label>
                        <div id="category-checkboxes" style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px; background-color: #f8f9fa;">
                            {% for category in categories %}
                            <div class="form-check">
                                <input class="form-check-input category-checkbox" type="checkbox" value="{{ category }}" id="cat_{{ loop.index }}" checked>
                                <label class="form-check-label" for="cat_{{ loop.index }}">
                                    {{ category.title() }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Valitse v√§hint√§√§n yksi kategoria
                        </div>
                    </div>

                    <!-- Vaikeustasot -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-signal me-2"></i>2. Valitse vaikeustasot:
                        </label>
                        <div id="difficulty-checkboxes">
                            <div class="form-check">
                                <input class="form-check-input difficulty-checkbox" type="checkbox" value="helppo" id="diff-helppo" checked>
                                <label class="form-check-label" for="diff-helppo">
                                    <span class="badge bg-success">Helppo</span>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input difficulty-checkbox" type="checkbox" value="keskivaikea" id="diff-keskivaikea" checked>
                                <label class="form-check-label" for="diff-keskivaikea">
                                    <span class="badge bg-warning text-dark">Keskivaikea</span>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input difficulty-checkbox" type="checkbox" value="vaikea" id="diff-vaikea" checked>
                                <label class="form-check-label" for="diff-vaikea">
                                    <span class="badge bg-danger">Vaikea</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Valitse v√§hint√§√§n yksi vaikeustaso
                        </div>
                    </div>

                    <!-- Kysymysten m√§√§r√§ -->
                    <div class="mb-3">
                        <label for="question-count" class="form-label fw-bold">
                            <i class="fas fa-list-ol me-2"></i>3. Kysymysten m√§√§r√§:
                        </label>
                        <input type="number" class="form-control form-control-lg" id="question-count" value="10" min="1" max="100">
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Valitse 1-100 kysymyst√§
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Peruuta
                </button>
                <button type="button" class="btn btn-primary btn-lg" onclick="startCustomPractice()">
                    <i class="fas fa-play me-2"></i>Aloita harjoitus
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let practiceModalInstance = null;

// Avaa modal
function openPracticeModal() {
    const modal = document.getElementById('practiceModal');
    if (!practiceModalInstance) {
        practiceModalInstance = new bootstrap.Modal(modal);
    }
    practiceModalInstance.show();
}

// Aloita r√§√§t√§l√∂ity harjoitus
function startCustomPractice() {
    console.log('Aloitetaan r√§√§t√§l√∂ity harjoitus...');
    
    // Hae valitut kategoriat
    const categoryCheckboxes = document.querySelectorAll('.category-checkbox:checked');
    const categories = [];
    categoryCheckboxes.forEach(checkbox => {
        categories.push(checkbox.value);
    });

    // Hae valitut vaikeustasot
    const difficultyCheckboxes = document.querySelectorAll('.difficulty-checkbox:checked');
    const difficulties = [];
    difficultyCheckboxes.forEach(checkbox => {
        difficulties.push(checkbox.value);
    });

    // Hae kysymysten m√§√§r√§
    const count = document.getElementById('question-count').value;

    console.log('Kategoriat:', categories);
    console.log('Vaikeustasot:', difficulties);
    console.log('M√§√§r√§:', count);

    // Validoi
    if (categories.length === 0) {
        alert('‚ùå Valitse v√§hint√§√§n yksi kategoria!');
        return;
    }

    if (difficulties.length === 0) {
        alert('‚ùå Valitse v√§hint√§√§n yksi vaikeustaso!');
        return;
    }

    if (!count || count < 1 || count > 100) {
        alert('‚ùå Kysymysten m√§√§r√§n tulee olla 1-100 v√§lill√§!');
        return;
    }

    // Rakenna URL parametrit
    const params = new URLSearchParams();
    
    // Lis√§√§ jokainen kategoria erikseen
    categories.forEach(cat => {
        params.append('categories', cat);
    });
    
    // Lis√§√§ jokainen vaikeustaso erikseen
    difficulties.forEach(diff => {
        params.append('difficulties', diff);
    });
    
    params.append('count', count);

    // Sulje modal
    if (practiceModalInstance) {
        practiceModalInstance.hide();
    }

    // Ohjaa harjoitussivulle
    const url = '/practice?' + params.toString();
    console.log('Ohjataan:', url);
    window.location.href = url;
}

// Enter-n√§pp√§in modalissa
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('practiceModal');
    if (modal) {
        modal.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                startCustomPractice();
            }
        });
    }
    
    // Fokusoi kysymysten m√§√§r√§ kun modal aukeaa
    modal.addEventListener('shown.bs.modal', function() {
        document.getElementById('question-count').focus();
    });
});
</script>
{% endblock %}